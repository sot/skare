NAME = skare
VERSION = `ska_version.py`
PREFIX = @prefix@
STDCONF = --prefix $(PREFIX)
# --allow-errors

install:
	echo "Need to specify an explicit target"

# Full install of operational Ska runtime environment
# The order is important
all_32: basedirs libs python_32 perl std_extras

all_64: basedirs libs python_64 perl std_extras

basedirs:
	./install.py --prefix $(PREFIX) --no-env-vars --config template

libs: xtime wcstools cfitsio libg2c_bin pgplot gsl hdf5 expat libyaml mpich2 gtk num_libs_bin zmq

python_32: activepython_32 libpython_so32 num_sci_src swig pygtk python_modules

python_64: activepython_64 libpython_so64 num_sci_src swig pygtk python_modules

std_extras: meld git sherpaX

perl: perl_from_source perl_modules libmysql perl_dbi

perl_from_source:
	./install.py $(STDCONF) --config perl_from_source

# Packages in support of python modules (req'd for operational Ska RE)
activepython_32:
	./install.py $(STDCONF) --config activepython_32

activepython_64:
	./install.py $(STDCONF) --config activepython_64

libpython_so32:
	./install.py $(STDCONF) --config libpython_so32

libpython_so64:
	./install.py $(STDCONF) --config libpython_so64

pycore:
	./install.py $(STDCONF) --config pycore

num_sci_pypm:
	./install.py $(STDCONF) --config num_sci_pypm

num_sci_src:
	./install.py $(STDCONF) --config num_sci_src

gtk:
	./install.py $(STDCONF) --config gtk

pygtk:
	./install.py $(STDCONF) --config pygtk

hdf5:
	./install.py $(STDCONF) --config hdf5

meld:
	./install.py $(STDCONF) --config meld

num_libs:
	./install.py $(STDCONF) --config num_libs

libmysql:
	./install.py $(STDCONF) --config mysql

num_libs_bin:
	./install.py $(STDCONF) --config num_libs_bin

libg2c_bin:
	./install.py $(STDCONF) --config libg2c_bin

expat:
	./install.py $(STDCONF) --config expat

libyaml:
	./install.py $(STDCONF) --config libyaml

mpich2:
	./install.py $(STDCONF) --config mpich2

psycopg2:
	./install.py $(STDCONF) --config psycopg2

wcstools:
	./install.py $(STDCONF) --config wcstools

swig:
	./install.py $(STDCONF) --config swig

xtime:
	./install.py $(STDCONF) --config xtime

zmq:
	./install.py $(STDCONF) --config zmq

cfitsio:
	./install.py $(STDCONF) --config cfitsio

gsl:
	./install.py $(STDCONF) --config gsl

git:
	./install.py $(STDCONF) --config git

pgplot:
	./install.py $(STDCONF) --config pgplot

sherpa:
	./install.py $(STDCONF) --config sherpa

sherpaX:
	./install.py $(STDCONF) --config ciao-sherpa
	./install.py $(STDCONF) --config sherpaX

# Optional packages for python modules
pycuda:
	./install.py $(STDCONF) --config pycuda

python_modules:
	./install.py $(STDCONF) --config python_modules

# Perl 5.8.x
perl_modules:
	./install.py $(STDCONF) --config perl_modules

perl_dbi:
	./install.py $(STDCONF) --config perl_dbi

dist:
	mkdir $(NAME)-$(VERSION)
	mkdir -p dist
	tar --exclude .svn --exclude "*.pyc" --exclude "*~" --create --files-from=MANIFEST --file - \
	 | (tar --extract --directory $(NAME)-$(VERSION) --file - )
	tar --create --verbose --gzip --file dist/$(NAME)-$(VERSION).tar.gz $(NAME)-$(VERSION)
	rm -rf $(NAME)-$(VERSION)

bdist_32:
	tar --create --bzip2 --file $(NAME)-$(VERSION)-32.tar.bz2 \
	$(PREFIX)/bin $(PREFIX)/include $(PREFIX)/arch $(PREFIX)/lib \
	$(PREFIX)/build/*/*/.installed

bdist_64:
	tar --create --bzip2 --file $(NAME)-$(VERSION)-64.tar.bz2 \
	$(PREFIX)/bin $(PREFIX)/include $(PREFIX)/arch $(PREFIX)/lib \
	$(PREFIX)/build/*/*/.installed
