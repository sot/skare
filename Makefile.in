NAME = skare
VERSION = `ska_version.py`
PREFIX = @prefix@
STDCONF = --prefix $(PREFIX) --config env_vars.cfg 
# --allow-errors

install:
	echo "Need to specify an explicit target"

# Full install of operational Ska runtime environment
# The order is important
all_32: basedirs libs python_32 perl std_extras

all_64: basedirs libs python_64 perl std_extras

basedirs:
	./install.py --prefix $(PREFIX) --config template.cfg

libs: xtime wcstools cfitsio pgplot gsl hdf5 libyaml mpich2 gtk num_libs_bin zmq

python_32: activepython_32 libpython_so32 num_sci_src swig pygtk python_modules

python_64: activepython_64 libpython_so64 num_sci_src swig pygtk python_modules

std_extras: meld git sherpaX

perl: perl_modules perl_dbi

# Packages in support of python modules (req'd for operational Ska RE)
activepython_32:
	./install.py $(STDCONF) --config activepython_32.cfg

activepython_64:
	./install.py $(STDCONF) --config activepython_64.cfg

libpython_so32:
	./install.py $(STDCONF) --config libpython_so32.cfg

libpython_so64:
	./install.py $(STDCONF) --config libpython_so64.cfg

pycore:
	./install.py $(STDCONF) --config pycore.cfg

num_sci_pypm:
	./install.py $(STDCONF) --config num_sci_pypm.cfg

num_sci_src:
	./install.py $(STDCONF) --config num_sci_src.cfg

gtk:
	./install.py $(STDCONF) --config gtk.cfg

pygtk:
	./install.py $(STDCONF) --config pygtk.cfg

hdf5:
	./install.py $(STDCONF) --config hdf5.cfg 

meld:
	./install.py $(STDCONF) --config meld.cfg 

num_libs:
	./install.py $(STDCONF) --config num_libs.cfg 

num_libs_bin:
	./install.py $(STDCONF) --config num_libs_bin.cfg 

libyaml:
	./install.py $(STDCONF) --config libyaml.cfg 

mpich2:
	./install.py $(STDCONF) --config mpich2.cfg 

wcstools:
	./install.py $(STDCONF) --config wcstools.cfg 

swig:
	./install.py $(STDCONF) --config swig.cfg 

xtime:
	./install.py $(STDCONF) --config xtime.cfg 

zmq:
	./install.py $(STDCONF) --config zmq.cfg 

cfitsio:
	./install.py $(STDCONF) --config cfitsio.cfg 

gsl:
	./install.py $(STDCONF) --config gsl.cfg 

git:
	./install.py $(STDCONF) --config git.cfg 

pgplot:
	./install.py $(STDCONF) --config pgplot.cfg 

sherpa:
	./install.py $(STDCONF) --config sherpa.cfg 

sherpaX:
	./install.py $(STDCONF) --config ciao-sherpa.cfg
	./install.py $(STDCONF) --config sherpaX.cfg 

# Optional packages for python modules
pycuda:
	./install.py $(STDCONF) --config pycuda.cfg

python_modules:
	./install.py $(STDCONF) --config python_modules.cfg

# Perl 5.8.x
perl_modules: 
	./install.py $(STDCONF) --config perl_modules.cfg 

perl_dbi:
	./install.py $(STDCONF) --config perl_dbi.cfg

dist:
	mkdir $(NAME)-$(VERSION)
	mkdir -p dist
	tar --exclude .svn --exclude "*.pyc" --exclude "*~" --create --files-from=MANIFEST --file - \
	 | (tar --extract --directory $(NAME)-$(VERSION) --file - )
	tar --create --verbose --gzip --file dist/$(NAME)-$(VERSION).tar.gz $(NAME)-$(VERSION)
	rm -rf $(NAME)-$(VERSION)

bdist_32:
	tar --create --bzip2 --file $(NAME)-$(VERSION)-32.tar.bz2 \
	$(PREFIX)/bin $(PREFIX)/include $(PREFIX)/arch $(PREFIX)/lib \
	$(PREFIX)/build/*/*/.installed

bdist_64:
	tar --create --bzip2 --file $(NAME)-$(VERSION)-64.tar.bz2 \
	$(PREFIX)/bin $(PREFIX)/include $(PREFIX)/arch $(PREFIX)/lib \
	$(PREFIX)/build/*/*/.installed

