NAME = skare
VERSION = 0.06
PREFIX = @prefix@
STDCONF = --prefix $(PREFIX) --config env_vars.cfg --allow-errors
# Full install of operational Ska runtime environment
# The order is important
all: basedirs libs pylibs python perl

except_python: basedirs perl perl_dbi

basedirs:
	./install.py --prefix $(PREFIX) --config template.cfg

libs: xtime wcstools cfitsio pgplot

pylibs: num_libs hdf5 libyaml 

python: python2 python3 swig python2_modules

perl: perl_modules perl_dbi

# Packages in support of python modules (req'd for operational Ska RE)
pygtk:
	./install.py $(STDCONF) --config pygtk.cfg

hdf5:
	./install.py $(STDCONF) --config hdf5.cfg 

meld:
	./install.py $(STDCONF) --config meld.cfg 

num_libs:
	./install.py $(STDCONF) --config num_libs.cfg 

libyaml:
	./install.py $(STDCONF) --config libyaml.cfg 

wcstools:
	./install.py $(STDCONF) --config wcstools.cfg 

swig:
	./install.py $(STDCONF) --config swig.cfg 

xtime:
	./install.py $(STDCONF) --config xtime.cfg 

cfitsio:
	./install.py $(STDCONF) --config cfitsio.cfg 

pgplot:
	./install.py $(STDCONF) --config pgplot.cfg 

# Optional packages for python modules
pycuda:
	./install.py $(STDCONF) --config pycuda.cfg

# Base python 2.x
python2:
	./install.py $(STDCONF) --config python.cfg

python2_modules:
	./install.py $(STDCONF) --config python_modules.cfg

# Base python 3.x
python3:
	./install.py $(STDCONF) --config python3.cfg 

# Perl 5.8.x
perl_modules: 
	./install.py $(STDCONF) --config perl_modules.cfg 

perl_dbi:
	./install.py $(STDCONF) --config perl_dbi.cfg

dist:
	mkdir $(NAME)-$(VERSION)
	mkdir -p dist
	tar --exclude .svn --exclude "*.pyc" --exclude "*~" --create --files-from=MANIFEST --file - \
	 | (tar --extract --directory $(NAME)-$(VERSION) --file - )
	tar --create --verbose --gzip --file dist/$(NAME)-$(VERSION).tar.gz $(NAME)-$(VERSION)
	rm -rf $(NAME)-$(VERSION)

